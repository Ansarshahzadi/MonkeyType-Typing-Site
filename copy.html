<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome 6 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <link rel="stylesheet" href="assets/css/custom.css" />
    <title>Typing Site</title>
  </head>
  <body class="bg-white">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-white sticky-top w-100">
      <div class="container-fluid px-5">
        <!-- Brand -->
        <a href="#" class="navbar-brand fw-bold fs-4">
          <span class="text-dark"
            >Aero<span style="color: rgb(234 88 12)">Page</span></span
          >
        </a>

        <!-- Toggler -->
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Menu -->
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link mx-3" href="#1st">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link mx-3" href="#2nd">Demos</a>
            </li>
            <li class="nav-item">
              <a class="nav-link mx-3" href="#3rd">Features</a>
            </li>
          </ul>
          <a href="index.html">
            <button type="button" class="btn btn-orange px-4">Sign IN</button>
          </a>
        </div>
      </div>
    </nav>

    <!-- Typing Test Section -->
    <section>
      <div class="container-fluid py-5">
        <!-- Controls -->
        <div
          class="d-flex flex-wrap align-items-center gap-3 py-5 justify-content-center"
        >
          <button id="startBtn" class="btn btn-orange">Start</button>
          <button id="resetBtn" class="btn btn-orange">Reset</button>

          <!-- Leadership Dropdown -->
          <div class="dropdown">
            <button
              class="btn btn-orange dropdown-toggle"
              type="button"
              id="leadershipMenu"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              Leaderboards
            </button>
            <ul class="dropdown-menu" aria-labelledby="leadershipMenu">
              <li>
                <a
                  class="dropdown-item passage-option"
                  data-type="simple"
                  href="#"
                  >Simple</a
                >
              </li>
              <li>
                <a
                  class="dropdown-item passage-option"
                  data-type="intermediate"
                  href="#"
                  >Intermediate</a
                >
              </li>
              <li>
                <a
                  class="dropdown-item passage-option"
                  data-type="standard"
                  href="#"
                  >Standard</a
                >
              </li>
            </ul>
          </div>

          <div
            class="stat px-3 py-1 rounded text-white"
            style="background-color: rgb(234 88 12)"
          >
            WPM: <span id="wpm">0</span>
          </div>
          <div
            class="stat px-3 py-1 rounded text-white"
            style="background-color: rgb(234 88 12)"
          >
            Accuracy: <span id="acc">100%</span>
          </div>
          <div
            class="stat px-3 py-1 rounded text-white"
            style="background-color: rgb(234 88 12)"
          >
            Errors: <span id="err">0</span>
          </div>
          <div
            class="stat px-3 py-1 rounded text-white"
            style="background-color: rgb(234 88 12)"
          >
            Time: <span id="time">00:00</span>
          </div>
        </div>

        <!-- Typing Panel -->
        <div class="panel p-4 border bg-white shadow-sm" id="typingPanel">
          <div id="text" class="text px-5" tabindex="0"></div>
          <div class="text-muted small mt-3 px-5">
            Tip: Click the text area (or press Start) and begin typing. Space
            moves to the next word. Backspace fixes mistakes.
          </div>
        </div>

        <!-- Fixed Hidden Input -->
        <input
          id="hiddenInput"
          type="text"
          style="opacity: 0; position: absolute; left: -9999px"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
        />
      </div>
    </section>

    <script>
      (function () {
        // Passages by difficulty
        const PASSAGES = {
          simple:
            "The cat runs fast. Dogs bark loud. Birds fly high. This is for beginners to practice typing slowly and clearly.",
          intermediate:
            "Typing speed improves with daily practice. Accuracy comes from focus and patience. Complex sentences help train your mind.",
          standard:
            "Leadership requires vision, communication, and decision making. A good leader inspires people, handles challenges, and creates opportunities for growth.",
        };

        // DOM elements
        const textEl = document.getElementById("text");
        const hiddenInput = document.getElementById("hiddenInput");
        const startBtn = document.getElementById("startBtn");
        const resetBtn = document.getElementById("resetBtn");
        const wpmEl = document.getElementById("wpm");
        const accEl = document.getElementById("acc");
        const errEl = document.getElementById("err");
        const timeEl = document.getElementById("time");

        // State variables
        let SAMPLE = PASSAGES.simple;
        let words = [];
        let wordEls = [];
        let currentWordIndex = 0,
          started = false,
          startTs = 0,
          timerId = null;
        let typedChars = 0,
          errorChars = 0;
        let caret = null;

        // Load passage
        function loadPassage(text) {
          textEl.innerHTML = "";
          SAMPLE = text;
          words = SAMPLE.trim().split(/\s+/);
          currentWordIndex = 0;
          typedChars = 0;
          errorChars = 0;
          started = false;
          clearInterval(timerId);
          wpmEl.textContent = "0";
          accEl.textContent = "100%";
          errEl.textContent = "0";
          timeEl.textContent = "00:00";

          wordEls = words.map((w, wi) => {
            const span = document.createElement("span");
            span.className = "word" + (wi === 0 ? " current" : "");
            [...w].forEach((ch) => {
              const c = document.createElement("span");
              c.className = "char future";
              c.textContent = ch;
              span.appendChild(c);
            });
            textEl.appendChild(span);
            return span;
          });

          caret = document.createElement("div");
          caret.className = "caret";
          wordEls[0].appendChild(caret);
          moveCaret(0);
        }

        // Init
        loadPassage(SAMPLE);

        // Dropdown
        document.querySelectorAll(".passage-option").forEach((item) => {
          item.addEventListener("click", (e) => {
            e.preventDefault();
            const type = e.target.dataset.type;
            loadPassage(PASSAGES[type]);
          });
        });

        // Input focus
        function focusInput() {
          hiddenInput.focus();
        }
        textEl.addEventListener("click", focusInput);
        startBtn.addEventListener("click", () => {
          if (!started) start();
          focusInput();
        });
        resetBtn.addEventListener("click", () => loadPassage(SAMPLE));

        // Input events
        hiddenInput.addEventListener("input", (e) => {
          if (!started) start();
          typedChars++; // count every keystroke
          paintCurrentWord();
          updateHud();
        });

        hiddenInput.addEventListener("keydown", (e) => {
          if (!started) start();
          if (e.key === " ") {
            e.preventDefault();
            finalizeWord();
            updateHud();
          }
        });

        function start() {
          started = true;
          startTs = performance.now();
          timerId = setInterval(updateHud, 1000);
        }

        function elapsedMinutes() {
          return Math.max(0, performance.now() - startTs) / 60000;
        }

        function updateHud() {
          const minutes = Math.max(0.01, elapsedMinutes());
          const gross = typedChars / 5 / minutes;
          const net = Math.max(0, gross - errorChars / minutes);
          const acc = typedChars
            ? ((typedChars - errorChars) / typedChars) * 100
            : 100;
          wpmEl.textContent = net.toFixed(0);
          accEl.textContent = acc.toFixed(0) + "%";
          errEl.textContent = errorChars;
          const totalMs = performance.now() - startTs;
          const s = Math.floor(totalMs / 1000);
          const mm = String(Math.floor(s / 60)).padStart(2, "0");
          const ss = String(s % 60).padStart(2, "0");
          timeEl.textContent = `${mm}:${ss}`;
        }

        function paintCurrentWord() {
          const curWordEl = wordEls[currentWordIndex];
          const target = words[currentWordIndex];
          const typed = hiddenInput.value;
          const maxLen = Math.max(target.length, typed.length);

          while (curWordEl.children.length - 1 < maxLen) {
            const c = document.createElement("span");
            c.className = "char future";
            c.textContent = "\u00B7";
            curWordEl.insertBefore(c, caret);
          }

          for (let i = 0; i < maxLen; i++) {
            const chSpan = curWordEl.querySelector(`.char:nth-child(${i + 1})`);
            const expected = target[i];
            const actual = typed[i];
            if (actual == null) {
              chSpan.className = "char future";
              chSpan.textContent = expected ?? "\u00B7";
            } else if (expected == null) {
              chSpan.className = "char wrong";
              chSpan.textContent = actual;
            } else if (actual === expected) {
              chSpan.className = "char correct";
              chSpan.textContent = expected;
            } else {
              chSpan.className = "char wrong";
              chSpan.textContent = actual;
              errorChars++;
            }
          }
          moveCaret(Math.min(typed.length, maxLen));
        }

        function moveCaret(charIndex) {
          const curWordEl = wordEls[currentWordIndex];
          let x = 0;
          for (let i = 0; i < charIndex; i++) {
            const span = curWordEl.querySelector(`.char:nth-child(${i + 1})`);
            if (!span) break;
            const rect = span.getBoundingClientRect();
            x = rect.right - curWordEl.getBoundingClientRect().left;
          }
          caret.style.transform = `translateX(${Math.round(x)}px)`;
          caret.style.width = "16px";
        }

        function finalizeWord() {
          const target = words[currentWordIndex];
          const typed = hiddenInput.value;
          const len = Math.max(target.length, typed.length);
          for (let i = 0; i < len; i++) {
            const expected = target[i];
            const actual = typed[i];
            if (actual == null) {
              if (expected != null) errorChars++;
            } else if (expected == null) {
              errorChars++;
              typedChars++;
            } else {
              typedChars++;
              if (actual !== expected) errorChars++;
            }
          }
          wordEls[currentWordIndex].classList.remove("current");
          currentWordIndex++;
          hiddenInput.value = "";
          if (currentWordIndex >= words.length) {
            clearInterval(timerId);
            updateHud();
            const done = document.createElement("div");
            done.className = "mt-3 fw-bold text-success";
            done.textContent =
              "✅ Finished! Press Reset or choose another passage.";
            textEl.appendChild(done);
            return;
          }
          const nextWordEl = wordEls[currentWordIndex];
          nextWordEl.classList.add("current");
          nextWordEl.appendChild(caret);
          moveCaret(0);
        }
      })();
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
