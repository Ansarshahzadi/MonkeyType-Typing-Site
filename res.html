<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Monkeytype Style Typing Test</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
</head>
<body style="background:#fff; color:#222; font-family:monospace;">

  <!-- Top bar -->
  <div class="d-flex justify-content-center align-items-center gap-3 border-bottom"
       style="background:#f1f1f1; padding:10px; font-size:14px;">
    <span id="punctuation" style="cursor:pointer; color:#666;">@ punctuation</span>
    <span id="numbers" style="cursor:pointer; color:#666;"># numbers</span>
    <span id="words" style="cursor:pointer; color:#666;">A words</span>
    <span id="quote" style="cursor:pointer; color:#666;">" quote</span>
    <span id="zen" style="cursor:pointer; color:#666;">△ zen</span>
    <span id="custom" style="cursor:pointer; color:#666;">✎ custom</span>
    <span id="btn15" style="cursor:pointer; color:#666;">15</span>
    <span id="btn30" style="cursor:pointer; color:#666;">30</span>
    <span id="btn60" style="cursor:pointer; color:#d35400; font-weight:bold;">60</span>
    <span id="btn120" style="cursor:pointer; color:#666;">120</span>
    <span id="gear" style="cursor:pointer; color:#666;">⚙</span>
  </div>

  <!-- Timer -->
  <div class="text-center mt-3">⏳ Time Left: <span id="timer">0</span> sec</div>

  <!-- Typing Area -->
  <div id="textDisplay" 
       style="font-size:18px; line-height:1.7rem; text-align:justify; margin:30px auto; max-width:900px; color:#333;">
  </div>

  <!-- Custom Paragraph Box -->
  <div id="customParagraphBox" style="display:none; margin-top:15px; text-align:center;">
    <textarea id="customParagraph" rows="10" placeholder="Type or paste your custom paragraph here..."
              style="background:#fafafa; border:1px solid #ccc; color:#000; padding:5px; font-family:monospace; width:80%;"></textarea><br/>
    <button class="btn btn-sm btn-warning mt-2" id="setParagraph">Set Paragraph</button>
  </div>

  <!-- Modal for Custom Time -->
  <div class="modal fade" id="timeModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content" style="border-radius:10px;">
        <div class="modal-header">
          <h5 class="modal-title">Set Custom Time</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="number" id="customTimeInput" class="form-control" placeholder="Enter seconds"/>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-warning" id="setCustomTime">Set Time</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let timerDisplay = document.getElementById("timer");
    let interval, timeLeft = 0, started = false;
    let currentText = "";
    let currentIndex = 0, correct = 0, incorrect = 0;
    let wpmTimeline = [];
    let errorTimeline = [];

    const textDisplay = document.getElementById("textDisplay");

    const texts = {
      words: "Typing is a skill that improves only with practice and patience. By writing words again and again, your fingers learn rhythm and speed. Keep going and do not stop midway, because consistency is key to achieving fluency in typing.",
      punctuation: "Punctuation makes writing clear and meaningful. Without commas, periods, or question marks, words become confusing. Can you imagine reading this paragraph without any punctuation marks at all? It would be difficult, right?",
      numbers: "Numbers are everywhere in daily life. From 1, 2, 3 in simple counting to 2025 in our year, they guide us. Typing numbers correctly improves attention to detail, since even a single wrong digit can completely change the meaning.",
      quote: "“Success is not final, failure is not fatal: it is the courage to continue that counts.” These words by Winston Churchill remind us that persistence matters more than temporary outcomes in the journey of life.",
      zen: "Zen typing means staying calm, breathing slowly, and typing with steady hands. It is not just about speed but about flow. Empty your mind from distractions, focus only on the letters, and let your thoughts align with the rhythm of your fingers."
    };

    function loadText(type) {
      currentText = texts[type];
      renderText();
      currentIndex = 0;
      correct = 0;
      incorrect = 0;
      wpmTimeline = [];
      errorTimeline = [];
    }

    function renderText() {
      textDisplay.innerHTML = "";
      currentText.split("").forEach((ch) => {
        let span = document.createElement("span");
        span.innerText = ch;
        textDisplay.appendChild(span);
      });
    }

    function startTimer(seconds) {
      clearInterval(interval);
      timeLeft = seconds;
      timerDisplay.textContent = timeLeft;
      started = true;

      let elapsed = 0;
      interval = setInterval(() => {
        timeLeft--;
        elapsed++;
        timerDisplay.textContent = timeLeft;

        // WPM per second
        let wordsTyped = correct / 5;
        let wpm = Math.round((wordsTyped / elapsed) * 60);
        wpmTimeline.push(wpm);
        errorTimeline.push(incorrect);

        if (timeLeft <= 0) {
          clearInterval(interval);
          finishTest(elapsed);
        }
      }, 1000);
    }

    function finishTest(totalTime) {
      started = false;
      const totalTyped = correct + incorrect;
      const accuracy = totalTyped > 0 ? Math.round((correct / totalTyped) * 100) : 0;
      const wpm = Math.round((correct / 5) / (totalTime / 60));

      const result = {
        wpm,
        accuracy,
        correct,
        incorrect,
        totalTyped,
        time: totalTime,
        wpmTimeline,
        errorTimeline
      };

      localStorage.setItem("typingResult", JSON.stringify(result));
      window.location.href = "result.html";
    }

    // Typing handling
    document.addEventListener("keydown", (e) => {
      if (!started) return;
      const spans = textDisplay.querySelectorAll("span");
      if (currentIndex < spans.length && e.key.length === 1) {
        const expected = spans[currentIndex].innerText;
        if (e.key === expected) {
          spans[currentIndex].style.color = "lightgrey";
          correct++;
        } else {
          spans[currentIndex].style.color = "red";
          incorrect++;
        }
        currentIndex++;
      } else if (e.key === "Backspace" && currentIndex > 0) {
        currentIndex--;
        spans[currentIndex].style.color = "#333";
      }
    });

    // Default text
    loadText("words");

    // Buttons
    document.getElementById("punctuation").onclick = () => loadText("punctuation");
    document.getElementById("numbers").onclick = () => loadText("numbers");
    document.getElementById("words").onclick = () => loadText("words");
    document.getElementById("quote").onclick = () => loadText("quote");
    document.getElementById("zen").onclick = () => loadText("zen");

    document.getElementById("btn15").onclick = () => startTimer(15);
    document.getElementById("btn30").onclick = () => startTimer(30);
    document.getElementById("btn60").onclick = () => startTimer(60);
    document.getElementById("btn120").onclick = () => startTimer(120);

    // Gear icon for modal
    document.getElementById("gear").onclick = () => {
      let modal = new bootstrap.Modal(document.getElementById("timeModal"));
      modal.show();
    };

    document.getElementById("setCustomTime").onclick = () => {
      let sec = parseInt(document.getElementById("customTimeInput").value);
      if (sec > 0) {
        startTimer(sec);
        bootstrap.Modal.getInstance(document.getElementById("timeModal")).hide();
      }
    };

    // Custom paragraph
    document.getElementById("custom").onclick = () => {
      document.getElementById("customParagraphBox").style.display = "block";
      textDisplay.innerText = "";
    };
    document.getElementById("setParagraph").onclick = () => {
      let para = document.getElementById("customParagraph").value.trim();
      if (para.length > 0) {
        currentText = para;
        renderText();
        currentIndex = 0;
        correct = 0;
        incorrect = 0;
        document.getElementById("customParagraphBox").style.display = "none";
      }
    };
  </script>
</body>
</html>
