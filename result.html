<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Typing Test Results</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light" style="font-family: monospace;">

  <div class="container my-5">
    <!-- Header -->
    <h2 class="text-center fw-bold mb-4">⌨️ Typing Test Results</h2>

    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
      <div class="col-md-3">
        <div class="card text-center shadow-sm border-0">
          <div class="card-body">
            <h6 class="text-muted">WPM</h6>
            <h3 id="wpm">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center shadow-sm border-0">
          <div class="card-body">
            <h6 class="text-muted">Accuracy</h6>
            <h3 id="accuracy">0%</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center shadow-sm border-0">
          <div class="card-body">
            <h6 class="text-muted">Errors</h6>
            <h3 id="errors">0</h3>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-center shadow-sm border-0">
          <div class="card-body">
            <h6 class="text-muted">Time</h6>
            <h3 id="time">0:00</h3>
          </div>
        </div>
      </div>
    </div>

    <!-- Detailed Stats -->
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-body">
        <h5 class="fw-bold">📊 Detailed Stats</h5>
        <p><strong>Gross Speed:</strong> <span id="grossSpeed">0</span> wpm</p>
        <p><strong>Net Speed:</strong> <span id="netSpeed">0</span> wpm</p>
        <p><strong>Total Typed:</strong> <span id="typed">0</span></p>
        <p><strong>Correct:</strong> <span id="correct">0</span></p>
        <p><strong>Incorrect:</strong> <span id="incorrect">0</span></p>
      </div>
    </div>

   

    <!-- Buttons -->
    <div class="text-center mt-4">
      <a href="index.html" class="btn btn-primary px-4">🔁 Try Again</a>
      <button class="btn btn-success px-4">💾 Save Result</button>
      <button class="btn btn-outline-dark px-4" onclick="window.print()">🖨 Print</button>
    </div>
  </div>

  <script>
    // Get result from localStorage
    let result = JSON.parse(localStorage.getItem("typingResult")) || {
      time: 65, wpm: 42, accuracy: 86, correct: 200, incorrect: 32,
      totalTyped: 232, charStats: { a: { errors: 5 }, e: { errors: 8 }, g: { errors: 3 }, t: { errors: 2 } },
      wpmHistory: [20, 28, 32, 40, 42, 41, 43]
    };

    // Update text values
    let m = Math.floor(result.time / 60);
    let s = result.time % 60;
    document.getElementById("time").innerText = `${m}:${s.toString().padStart(2,"0")}`;
    document.getElementById("wpm").innerText = result.wpm;
    document.getElementById("accuracy").innerText = result.accuracy + "%";
    document.getElementById("errors").innerText = result.incorrect;
    document.getElementById("grossSpeed").innerText = result.wpm;
    document.getElementById("netSpeed").innerText = Math.max(result.wpm - result.incorrect, 0);
    document.getElementById("typed").innerText = result.totalTyped;
    document.getElementById("correct").innerText = result.correct;
    document.getElementById("incorrect").innerText = result.incorrect;

    // Difficult Keys Chart
    let labels = Object.keys(result.charStats);
    let data = labels.map(k => result.charStats[k].errors);
    let colors = data.map(err => err >= 5 ? "red" : err >= 2 ? "orange" : "green");

    new Chart(document.getElementById("difficultKeysChart"), {
      type: "bar",
      data: { labels, datasets: [{ data, backgroundColor: colors }] },
      options: { plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
    });

    // WPM Over Time Chart
    new Chart(document.getElementById("wpmChart"), {
      type: "line",
      data: {
        labels: result.wpmHistory.map((_, i) => `t${i+1}`),
        datasets: [{ label: "WPM", data: result.wpmHistory, borderColor: "blue", fill: false }]
      },
      options: { responsive: true, plugins: { legend: { display: false } } }
    });
  </script>
</body>
</html>
